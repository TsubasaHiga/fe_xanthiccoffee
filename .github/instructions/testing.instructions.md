---
applyTo: "src/**/*.test.tsx,src/**/*.spec.tsx,src/**/*.test.ts,src/**/*.spec.ts,e2e/**/*.spec.ts"
---

## テスト実行ルール
- テストは必ず単一実行モードで実行してください。
- 長時間実行されるテストは適切なタイムアウトを設定してください。
- E2Eテストで無限に実行される場合は、プロセスを停止してから再実行してください。
- テストプロセスが応答しない場合は `pkill -f "pnpm|playwright|node"` で強制終了してください。

## PDF関連テストの注意事項
- PDFエクスポート機能のテストはブラウザ環境に依存するため、タイムアウトを長めに設定してください。
- html2canvas-proとjsPDFライブラリの動的インポートが正しく動作するか確認してください。
- ダウンロードイベントの待機時間は10秒以内に設定してください。
- PDF生成テストは単発実行で行い、並列実行は避けてください。

## 既知の問題
- markdown editorのdata-testid選択時は、内部のtextarea要素を指定する必要があります。
- ライブラリインポートエラーが発生した場合は、依存関係を確認してください。

## トラブルシューティング
- テストが停止した場合は、まずプロセスを強制終了してから再実行してください。
- PDFテスト前にユニットテストで基本機能を確認してください。
- E2Eテストはheadedモードで実行してブラウザの動作を確認してください。
- ターミナルが応答しない場合は、新しいターミナルセッションを開始してください。

## モックの設定
- MarkdownViewerテストでは`ConfiguredMdEditor`のモックを必ず追加してください。
- PDF関連テストでは`html2canvas-pro`と`jspdf`の両方をモックしてください。
- 動的インポートのモックは`vi.mock()`を使用してください。

## 推奨実行順序
1. まず`pnpm lint`でコードチェック
2. 次に`pnpm test --run`でユニットテスト
3. 最後に`pnpm test:e2e`で単一のE2Eテストから実行